package com.controller;

import com.annotation.IgnoreAuth;
import org.springframework.beans.factory.annotation.Autowired;
import com.baomidou.mybatisplus.mapper.EntityWrapper;

import javax.servlet.http.HttpServletRequest;

import com.service.SHiveService;
import com.service.EshianyycfService;
import com.entity.EshianyycfEntity;
import com.utils.R;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import java.sql.SQLException;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("shive")
public class SHiveController {

    @Autowired
    private SHiveService sHiveService;

                                                                                                                                                                @Autowired
                private EshianyycfService eshianyycfService;
                                                                                                                                                                                        private String dataBase = "springboot5578bn9k";

    @IgnoreAuth
    @RequestMapping("analyze")
    public R analyze(HttpServletRequest request) throws Exception {
        sHiveService.createDatabase(dataBase);
        value(request);
        valueMul(request);
        group(request);
        return R.ok();
    }

    /**
    * （按值统计）
    */
    private void value(HttpServletRequest request) throws Exception {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                    sHiveService.init(dataBase, "eshianyycf", eshianyycfService.selectList(new EntityWrapper<EshianyycfEntity>()));
                                                    for (int i = 0; i < ",cname".split(",").length; i++) {
                        String xColumn = ",cname".split(",")[i];
                        if ("".equals(xColumn)) {
                            continue;
                        }
                        String[] timeTypes = ",无".trim().split(",");
                        String[] yColumns = ",danbaizhi".trim().split(",");
                        String timeType = (i < timeTypes.length && timeTypes[i] != "" && !timeTypes[i].equals("无")) ? timeTypes[i] : "timeType";
                        String where = "";
                                                                        sHiveService.value(dataBase, "eshianyycf", xColumn, timeType, where, yColumns[i]);
                    }
                                                                                                                                                                                                                                                                                                            }

    private String Where(String where_, String sql) {
        if ("" == where_) {
            where_ += " where ";
        } else {
            where_ += " and ";
        }
        return where_ += sql;
    }

    /**
     * （按值统计(多)）
     */
    private void valueMul(HttpServletRequest request) throws Exception {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }


    /**
 * （按类统计）
 */
    private void group(HttpServletRequest request) throws Exception {
                                                                                                                                sHiveService.init(dataBase, "eshianyycf", eshianyycfService.selectList(new EntityWrapper<EshianyycfEntity>()));
                            sHiveService.group(dataBase, "eshianyycf", "cname", "");
                                                                                                                                                                        sHiveService.init(dataBase, "eshianyycf", eshianyycfService.selectList(new EntityWrapper<EshianyycfEntity>()));
                            sHiveService.group(dataBase, "eshianyycf", "spfenlei", "");
                                                                                                                                                                                                            sHiveService.init(dataBase, "eshianyycf", eshianyycfService.selectList(new EntityWrapper<EshianyycfEntity>()));
                            sHiveService.group(dataBase, "eshianyycf", "chandi", "");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

}
